<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daemon Social Network Monitor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a;
            color: #fff;
            padding: 2rem;
        }

        .header {
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .summary-card h3 {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .summary-card .value {
            font-size: 2rem;
            font-weight: bold;
        }

        .summary-card.online .value { color: #4ade80; }
        .summary-card.offline .value { color: #f87171; }
        .summary-card.total .value { color: #60a5fa; }

        .nodes {
            display: grid;
            gap: 1rem;
        }

        .node-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .node-card.online {
            border-color: #4ade80;
        }

        .node-card.offline {
            border-color: #f87171;
        }

        .node-card.error {
            border-color: #fbbf24;
        }

        .node-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .node-type {
            font-size: 1.2rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .node-status {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .node-status.online {
            background: #4ade80;
            color: #000;
        }

        .node-status.offline {
            background: #f87171;
            color: #fff;
        }

        .node-status.error {
            background: #fbbf24;
            color: #000;
        }

        .node-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            color: #888;
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }

        .info-value {
            font-size: 1rem;
        }

        .error-message {
            color: #f87171;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .last-update {
            text-align: center;
            color: #888;
            margin-top: 2rem;
            font-size: 0.9rem;
        }

        .refresh-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 1rem;
        }

        .refresh-btn:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç Daemon Social Network Monitor</h1>
        <button class="refresh-btn" onclick="refresh()">Refresh</button>
    </div>

    <div class="summary" id="summary"></div>

    <div class="nodes" id="nodes"></div>

    <div class="last-update" id="lastUpdate"></div>

    <script>
        const ws = new WebSocket('ws://localhost:8080');

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'status' || data.type === 'update') {
                updateDashboard(data.data);
            }
        };

        ws.onerror = () => {
            console.error('WebSocket error');
        };

        async function refresh() {
            const response = await fetch('/api/check', { method: 'POST' });
            const data = await response.json();
            console.log('Manual refresh:', data);
        }

        function updateDashboard(nodes) {
            // Update summary
            const online = nodes.filter(n => n.status === 'online').length;
            const offline = nodes.filter(n => n.status === 'offline').length;
            const errors = nodes.filter(n => n.status === 'error').length;
            const total = nodes.length;

            document.getElementById('summary').innerHTML = `
                <div class="summary-card total">
                    <h3>Total Nodes</h3>
                    <div class="value">${total}</div>
                </div>
                <div class="summary-card online">
                    <h3>Online</h3>
                    <div class="value">${online}</div>
                </div>
                <div class="summary-card offline">
                    <h3>Offline</h3>
                    <div class="value">${offline}</div>
                </div>
                <div class="summary-card error">
                    <h3>Errors</h3>
                    <div class="value">${errors}</div>
                </div>
            `;

            // Update nodes
            document.getElementById('nodes').innerHTML = nodes.map(node => `
                <div class="node-card ${node.status}">
                    <div class="node-header">
                        <div class="node-type">${node.type}</div>
                        <div class="node-status ${node.status}">${node.status.toUpperCase()}</div>
                    </div>
                    <div class="node-info">
                        <div class="info-item">
                            <div class="info-label">Endpoint</div>
                            <div class="info-value">${node.endpoint}</div>
                        </div>
                        ${node.responseTime ? `
                        <div class="info-item">
                            <div class="info-label">Response Time</div>
                            <div class="info-value">${node.responseTime}ms</div>
                        </div>
                        ` : ''}
                        <div class="info-item">
                            <div class="info-label">Last Check</div>
                            <div class="info-value">${new Date(node.lastCheck).toLocaleTimeString()}</div>
                        </div>
                    </div>
                    ${node.error ? `
                    <div class="error-message">Error: ${node.error}</div>
                    ` : ''}
                    ${node.metrics ? `
                    <div class="node-info" style="margin-top: 1rem;">
                        ${Object.entries(node.metrics).map(([key, value]) => `
                            <div class="info-item">
                                <div class="info-label">${key}</div>
                                <div class="info-value">${JSON.stringify(value)}</div>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                </div>
            `).join('');

            document.getElementById('lastUpdate').textContent =
                `Last updated: ${new Date().toLocaleTimeString()}`;
        }

        // Initial load
        fetch('/api/status')
            .then(res => res.json())
            .then(data => updateDashboard(data.nodes));
    </script>
</body>
</html>

